name: Netlib Keepalive

on:
  schedule:
    - cron: '0 0 */60 * *' # 每60天在UTC时间00:00运行（北京时间08:00）
  workflow_dispatch:  # 允许手动触发
    inputs:
      skip_telegram:
        description: '跳过 Telegram 通知'
        required: false
        default: 'false'

jobs:
  keepalive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install dependencies
      run: |
        npm ci
        npx playwright install chromium

    - name: Run Netlib keepalive
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        SITE_ACCOUNTS: ${{ secrets.SITE_ACCOUNTS }}
        SKIP_TELEGRAM: ${{ inputs.skip_telegram }}
      run: npm start

    - name: Upload logs on failure
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: netlib-error-logs
        path: |
          login_netlib.js
          package.json
        retention-days: 30name: Netlib Keepalive

on:
  schedule:
    # 每60天在UTC时间00:00运行（北京时间08:00）
    - cron: '0 0 */60 * *'
  workflow_dispatch:  # 允许手动触发
    inputs:
      skip_telegram:
        description: '跳过 Telegram 通知'
        required: false
        default: 'false'

jobs:
  keepalive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install dependencies
      run: |
        npm ci
        npx playwright install chromium

    - name: Run Netlib keepalive
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        SITE_ACCOUNTS: ${{ secrets.SITE_ACCOUNTS }}
        SKIP_TELEGRAM: ${{ inputs.skip_telegram }}
      run: npm start

    - name: Upload logs on failure
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: netlib-error-logs
        path: |
          login_netlib.js
          package.json
        retention-days: 30
